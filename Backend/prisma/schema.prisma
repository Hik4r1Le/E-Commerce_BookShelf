generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("MYSQL_DATABASE_URL")
}

enum Role {
  ADMIN
  USER
  SELLER
}

enum Gender {
  MALE
  FEMALE
  OTHERS
}

enum AddressLabel {
  HOME
  OFFICE
}

enum StockStatus {
  IN_STOCK
  OUT_OF_STOCK
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  READY_FOR_PICKUP
  SHIPPING
  DELIVERED
  CANCELLED
  RETURN_REQUESTED
  RETURNED
  REFUNDED
}

enum DiscountType {
  FIXED
  PERCENTAGE
}

enum BannerType {
  HOMEPAGE
  CATEGORY
  PRODUCT
  CUSTOM
}

enum Tag {
  BESTSELLER
  HOT
  NEW
  DISCOUNT
  LIMITED
  TRENDING
  POPULAR
  RECOMMENDED
}

enum OtpType {
  VERIFY_EMAIL
  RESET_PASSWORD
}

model Banner {
  id          String     @id @default(uuid()) @db.VarChar(255)
  creator     String     @db.VarChar(255)
  name        String     @db.VarChar(255)
  title       String     @db.VarChar(255)
  description String     @db.Text
  image_url   String     @db.VarChar(255)
  link_url    String     @db.VarChar(255)
  type        BannerType @default(HOMEPAGE)
  active      Boolean    @default(true)
  position    Int        @default(0)
  start_date  DateTime   @db.Timestamp(6)
  end_date    DateTime   @db.Timestamp(6)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  bannerCreator User            @relation(fields: [creator], references: [id])
  productBanner ProductBanner[]

  @@index([creator])
  @@map("banners")
}

model ProductBanner {
  id          String @id @default(uuid()) @db.VarChar(255)
  product_id  String @db.VarChar(255)
  banner_id   String @db.VarChar(255)
  category_id String @db.VarChar(255)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  product  Product?  @relation(fields: [product_id], references: [id])
  banner   Banner?   @relation(fields: [banner_id], references: [id])
  category Category? @relation(fields: [category_id], references: [id])

  @@index([product_id])
  @@index([banner_id])
  @@index([category_id])
  @@map("product_banner")
}

model Product {
  id           String    @id @default(uuid()) @db.VarChar(255)
  seller_id    String    @db.VarChar(255)
  name         String    @db.VarChar(255)
  tag          Tag       @default(NEW)
  author_name  String?   @db.VarChar(255)
  description  String?   @db.Text
  price        Decimal?  @db.Decimal(10, 2)
  discount     Decimal?  @db.Decimal(10, 2)
  rating_avg   Decimal?  @db.Decimal(10, 2)
  rating_count Int?
  sold_count   Int?
  image_url    String    @db.VarChar(255)
  release_date DateTime? @db.Timestamp(6)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  seller          User              @relation(fields: [seller_id], references: [id])
  productBanner   ProductBanner[]
  productCategory ProductCategory[]
  review          Review[]
  stock           Stock?

  @@index([seller_id])
  @@map("products")
}

model Category {
  id          String @id @default(uuid()) @db.VarChar(255)
  name        String @db.VarChar(255)
  slug        String @unique @db.VarChar(255)
  description String @db.Text
  icon        String @db.VarChar(255)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  productBanner   ProductBanner[]
  productCategory ProductCategory[]

  @@map("categories")
}

model ProductCategory {
  id          String @id @default(uuid()) @db.VarChar(255)
  product_id  String @db.VarChar(255)
  category_id String @db.VarChar(255)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  product  Product?  @relation(fields: [product_id], references: [id])
  category Category? @relation(fields: [category_id], references: [id])

  @@index([product_id])
  @@index([category_id])
  @@map("product_category")
}

model Review {
  id         String   @id @default(uuid()) @db.VarChar(255)
  product_id String   @db.VarChar(255)
  user_id    String?  @db.VarChar(255)
  username   String?  @db.VarChar(255)
  rating     Decimal? @db.Decimal(10, 2)
  comment    String   @db.Text

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  product Product? @relation(fields: [product_id], references: [id])
  user    User?    @relation(fields: [user_id], references: [id])

  @@index([product_id])
  @@index([user_id])
  @@map("reviews")
}

model User {
  id                String   @id @default(uuid()) @db.VarChar(255)
  email             String?  @unique @db.VarChar(255)
  username          String?  @db.VarChar(255)
  password_hash     String?  @db.VarChar(255)
  role              Role?    @default(USER)
  is_email_verified Boolean? @default(false)
  google_id         String?  @unique @db.VarChar(255)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  refreshToken   RefreshToken?
  profile        UserProfile?
  address        Address[]
  cart           Cart[]
  order          Order[]
  review         Review[]
  product        Product[]
  bannerCreator  Banner[]
  couponProvider Coupon[]

  @@map("users")
}

model Otp {
  id         String   @id @default(uuid()) @db.VarChar(255)
  email      String?  @db.VarChar(255)
  otp_hash   String?  @db.VarChar(255)
  type       OtpType  @default(VERIFY_EMAIL)
  expires_at DateTime @db.Timestamp(6)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  @@map("otps")
}

model RefreshToken {
  id         String   @id @default(uuid()) @db.VarChar(255)
  user_id    String   @unique @db.VarChar(255)
  token_hash String   @db.VarChar(255)
  is_revoked Boolean  @default(false)
  expires_at DateTime @db.Timestamp(6)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  user User? @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("refresh_tokens")
}

model UserProfile {
  id         String    @id @default(uuid()) @db.VarChar(255)
  user_id    String    @unique @db.VarChar(255)
  fullname   String?   @db.VarChar(255)
  dob        DateTime? @db.Date
  gender     Gender?   @default(MALE)
  avatar_url String?   @db.VarChar(255)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  user User @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("user_profiles")
}

model Address {
  id             String        @id @default(uuid()) @db.VarChar(255)
  user_id        String?       @db.VarChar(255)
  label          AddressLabel? @default(HOME)
  recipient_name String?       @db.VarChar(255)
  phone_number   String?       @db.VarChar(255)
  street         String?       @db.VarChar(255)
  district       String?       @db.VarChar(255)
  city           String?       @db.VarChar(255)
  is_default     Boolean?

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  user  User?   @relation(fields: [user_id], references: [id])
  order Order[]

  @@index([user_id])
  @@map("addresses")
}

model Stock {
  id         String       @id @default(uuid()) @db.VarChar(255)
  product_id String?      @unique @db.VarChar(255)
  quantity   Int?
  status     StockStatus? @default(IN_STOCK)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  product Product? @relation(fields: [product_id], references: [id])
  cart    Cart[]
  order   Order[]

  @@index([product_id])
  @@map("stocks")
}

model Cart {
  id           String   @id @default(uuid()) @db.VarChar(255)
  user_id      String?  @db.VarChar(255)
  stock_id     String?  @db.VarChar(255)
  quantity     Int?
  price_at_add Decimal? @db.Decimal(10, 2)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  user  User?  @relation(fields: [user_id], references: [id])
  stock Stock? @relation(fields: [stock_id], references: [id])

  @@index([user_id])
  @@index([stock_id])
  @@map("carts")
}

model Order {
  id      String  @id @default(uuid()) @db.VarChar(255)
  user_id String? @db.VarChar(255)

  address_id         String?      @db.VarChar(255)
  coupon_id          String?      @db.VarChar(255)
  stock_id           String?      @db.VarChar(255)
  shipping_method_id String?      @db.VarChar(255)
  quantity           Int?
  total_price        Decimal?     @db.Decimal(10, 2)
  status             OrderStatus? @default(PENDING)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  user           User?           @relation(fields: [user_id], references: [id])
  address        Address?        @relation(fields: [address_id], references: [id])
  coupon         Coupon?         @relation(fields: [coupon_id], references: [id])
  stock          Stock?          @relation(fields: [stock_id], references: [id])
  shippingMethod ShippingMethod? @relation(fields: [shipping_method_id], references: [id])

  @@index([user_id])
  @@index([address_id])
  @@index([coupon_id])
  @@index([stock_id])
  @@index([shipping_method_id])
  @@map("orders")
}

model ShippingMethod {
  id                  String   @id @default(uuid()) @db.VarChar(255)
  type                String?  @db.VarChar(255)
  shipping_fee        Decimal? @db.Decimal(10, 2)
  estimated_time_text String?  @db.VarChar(255)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  order Order[]

  @@map("shipping_methods")
}

model Coupon {
  id             String        @id @default(uuid()) @db.VarChar(255)
  provider       String?       @db.VarChar(255)
  code           String?       @unique @db.VarChar(255)
  discount_type  DiscountType? @default(PERCENTAGE)
  discount_value Decimal?      @db.Decimal(10, 2)
  usage_limit    Int?
  used_count     Int?
  start_date     DateTime?     @db.DateTime(0)
  end_date       DateTime?     @db.DateTime(0)

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @updatedAt @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)

  couponProvider User?   @relation(fields: [provider], references: [id])
  order          Order[]

  @@index([provider])
  @@map("coupons")
}
